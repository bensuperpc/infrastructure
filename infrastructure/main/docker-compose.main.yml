services:
  main_infrastructure:
    container_name: main_infrastructure
    image: alpine:latest
    profiles:
      - main_infrastructure
    volumes:
      - infrastructure_server_chown:/infrastructure_server:rw
      - public_data:/infrastructure_server/public:rw
      - private_data:/infrastructure_server/private:rw
    read_only: true
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    cap_add:
      - CHOWN
      - DAC_OVERRIDE
    # Fix root permissions on mounted volumes
    command: chown -R ${PUID:-1000}:${PGID:-1000} /infrastructure_server

volumes:
  infrastructure_server_chown:
    name: infrastructure_server_chown
  public_data:
    name: public_data
  private_data:
    name: private_data

networks:
  infra-network:
    driver: bridge
    name: infra-network